<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Intelligence - Pilot Command Center</title>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* V20 TEMEL TASARIM KORUMASI */
        :root {
            --nexus-blue: #0070f3;
            --bg-white: #ffffff;
            --card-gray: #f8f9fa;
            --text-dark: #111827;
            --border: #eaeaea;
            --terminal-bg: #111111;
        }

        body {
            background-color: var(--bg-white);
            color: var(--text-dark);
            font-family: 'Inter', sans-serif;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .header {
            width: 100%; max-width: 420px;
            background: var(--card-gray);
            border: 1px solid var(--border);
            padding: 25px; border-radius: 24px;
            text-align: center; margin-bottom: 20px;
        }

        #pilot-id {
            background: #eef2f6; color: var(--nexus-blue);
            padding: 5px 15px; border-radius: 50px;
            font-size: 13px; font-weight: 700; display: inline-block;
            margin-bottom: 10px; border: 1px solid var(--border);
        }

        .balance { font-size: 44px; font-weight: 800; margin: 10px 0; }
        .balance span { font-size: 16px; color: var(--nexus-blue); }

        /* VERA ENGINE: G√ñRSEL MINING (AI TRAINING) */
        .mining-container {
            width: 100%; max-width: 420px;
            background: var(--terminal-bg);
            border-radius: 16px; padding: 15px;
            border: 3px solid #333; margin-bottom: 20px;
        }

        #terminal {
            height: 100px; overflow-y: hidden;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px; color: #00ff00; line-height: 1.6;
        }

        .progress-bar-bg {
            width: 100%; height: 6px; background: #222;
            border-radius: 10px; margin-top: 10px; overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%; background: var(--nexus-blue); width: 0%;
            transition: width 0.3s ease; box-shadow: 0 0 10px var(--nexus-blue);
        }

        /* NFT & ACHIEVEMENTS */
        .card {
            width: 100%; max-width: 420px;
            background: var(--card-gray); border: 1px solid var(--border);
            border-radius: 20px; padding: 20px; margin-bottom: 15px;
        }

        .achievement-label {
            display: flex; justify-content: space-between;
            font-size: 11px; font-weight: 700; margin-bottom: 8px;
            color: #666; text-transform: uppercase;
        }

        /* BUTONLAR */
        .btn {
            width: 100%; max-width: 420px; padding: 16px;
            border-radius: 16px; border: none; font-weight: 700;
            cursor: pointer; margin-bottom: 10px;
        }
        .btn-primary { background: var(--nexus-blue); color: white; }
    </style>
</head>
<body>

    <div id="ton-connect-button"></div>

    <div class="header">
        <div id="pilot-id">CONNECT WALLET TO START</div>
        <div class="balance"><span id="balance-val">0.00</span> <span>$NI</span></div>
    </div>

    <div class="mining-container">
        <div id="terminal">> Initializing Vera Core...<br>> Standing by for Pilot...</div>
        <div class="progress-bar-bg"><div class="progress-bar-fill" id="mining-bar"></div></div>
    </div>

    <button class="btn btn-primary" onclick="startQuiz()">‚ö° TESTƒ∞ √á√ñZ (TOPLU √ñD√úL)</button>

    <div class="card">
        <div class="achievement-label"><span>NFT: 5000 TEST G√ñREVƒ∞</span> <span id="test-txt">0 / 5000</span></div>
        <div class="progress-bar-bg" style="background: #ddd; height: 10px;">
            <div class="progress-bar-fill" id="test-bar"></div>
        </div>
    </div>

    <div class="card">
        <div class="achievement-label"><span>SADAKAT: 1 YIL MADENCƒ∞Lƒ∞K</span> <span id="days-txt">0 G√úN</span></div>
        <div class="progress-bar-bg" style="background: #ddd; height: 10px;">
            <div class="progress-bar-fill" id="loyalty-bar" style="background: #10b981;"></div>
        </div>
    </div>

    <div class="card">
        <div style="font-weight: 800; font-size: 14px; margin-bottom: 10px; text-align: center;">üèÜ TOP 100 GLOBAL PILOTS</div>
        <div id="leaderboard"></div>
    </div>

    <script>
        const tonConnectUI = new TONConnectUI.TonConnectUI({
            manifestUrl: 'https://nexusintelligencelabs.github.io/nexusintelligence.github.io/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });

        let currentWallet = null;
        let userData = { balance: 0, tests: 0, start_date: null, pilotID: "" };
        let quizPool = 0;

        // 1. C√úZDAN BAZLI HAFIZA (LOGOUT = RESET, LOGIN = RESUME)
        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                currentWallet = wallet.account.address;
                loadPilotData();
            } else {
                currentWallet = null;
                resetUI();
            }
        });

        function loadPilotData() {
            const saved = localStorage.getItem('nexus_v21_' + currentWallet);
            if (saved) {
                userData = JSON.parse(saved);
            } else {
                userData = {
                    balance: 0,
                    tests: 0,
                    start_date: Date.now(),
                    pilotID: "Pilot-" + Math.floor(1000 + Math.random() * 9000)
                };
                saveData();
            }
            updateUI();
            startVisualMining();
            loadLeaderboard();
        }

        function saveData() {
            if (currentWallet) localStorage.setItem('nexus_v21_' + currentWallet, JSON.stringify(userData));
        }

        function updateUI() {
            document.getElementById('balance-val').innerText = userData.balance.toFixed(2);
            document.getElementById('pilot-id').innerText = userData.pilotID;
            
            // 4. NFT SAYA√áLARI
            document.getElementById('test-txt').innerText = `${userData.tests} / 5000`;
            document.getElementById('test-bar').style.width = (userData.tests / 5000 * 100) + "%";

            const days = Math.floor((Date.now() - userData.start_date) / (1000 * 60 * 60 * 24));
            document.getElementById('days-txt').innerText = `${days} G√úN`;
            document.getElementById('loyalty-bar').style.width = (days / 365 * 100) + "%";
        }

        function resetUI() {
            document.getElementById('balance-val').innerText = "0.00";
            document.getElementById('pilot-id').innerText = "CONNECT WALLET TO START";
            document.getElementById('terminal').innerHTML = "> Connection Lost...<br>> System Idle.";
            document.getElementById('mining-bar').style.width = "0%";
        }

        // 5. G√ñRSEL MADENCƒ∞Lƒ∞K (AI TRAINING LOGS)
        function startVisualMining() {
            const term = document.getElementById('terminal');
            const logs = [
                "Analyzing Neural Patterns...", "Image Batch #42 Processed.",
                "Optimizing AI Weights...", "Vera Core Syncing...",
                "Data Packet Validated."
            ];

            setInterval(() => {
                if (!currentWallet) return;
                let log = logs[Math.floor(Math.random() * logs.length)];
                term.innerHTML = `> ${log}<br>> Mining: +0.05 $NI`;
                
                let fill = document.getElementById('mining-bar');
                fill.style.width = "100%";
                setTimeout(() => {
                    fill.style.width = "0%";
                    userData.balance += 0.05;
                    updateUI();
                    saveData();
                }, 2000);
            }, 5000);
        }

        // 2. TOPLU QUIZ √ñD√úL√ú
        function startQuiz() {
            if (!currentWallet) return alert("√ñnce c√ºzdan baƒüla!");
            quizPool = 0;
            for(let i=1; i<=3; i++) {
                if(confirm(`Soru ${i}: Bu AI tarafƒ±ndan mƒ± √ºretildi?`)) {
                    quizPool += 10;
                    userData.tests += 1;
                }
            }
            // Claim Mantƒ±ƒüƒ±
            userData.balance += quizPool;
            alert(`Test bitti! ${quizPool} $NI bakiyene eklendi.`);
            saveData();
            updateUI();
        }

        // 3. Pƒ∞LOT ID & TOP 100
        function loadLeaderboard() {
            const list = [
                {id: "Pilot-8842", bal: 1250},
                {id: userData.pilotID, bal: userData.balance},
                {id: "Pilot-1102", bal: 80}
            ].sort((a,b) => b.bal - a.bal);

            document.getElementById('leaderboard').innerHTML = list.map((p, i) => 
                `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; font-size:13px;">
                    <span>${i+1}. ${p.id}</span>
                    <strong>${p.bal.toFixed(2)}</strong>
                </div>`
            ).join('');
        }
    </script>
</body>
</html>
