<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus Intelligence | Pilot Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #fbfbfd; color: #1d1d1f; -webkit-font-smoothing: antialiased; }
        .apple-card { background: #ffffff; border-radius: 28px; box-shadow: 0 8px 30px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.02); }
        .tab-content { display: none; }
        .tab-content.active { display: block !important; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .nav-active { color: #0071e3; }
        .mining-bar { transition: width 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
        #ton-connect-button { min-width: 140px; }
    </style>
</head>
<body class="pb-28">

    <nav class="fixed top-0 w-full z-50 bg-white/70 backdrop-blur-xl border-b border-gray-100 px-6 py-4 flex justify-between items-center">
        <div class="flex flex-col">
            <span class="text-xl font-extrabold tracking-tighter italic">NEXUS <span class="text-blue-600">INTEL</span></span>
            <span id="device-tag" class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">Sistem HazÄ±rlanÄ±yor...</span>
        </div>
        <div id="ton-connect-button"></div>
    </nav>

    <main id="tab-pilot" class="tab-content active pt-24 px-6 max-w-md mx-auto">
        <div class="apple-card p-10 mb-6 text-center">
            <p class="text-[10px] text-gray-400 font-bold mb-1 uppercase tracking-widest">OnaylanmÄ±ÅŸ NI Bakiyesi</p>
            <h2 class="text-6xl font-black text-gray-900 tracking-tighter mb-10" id="mainBal">0.00</h2>
            
            <div class="bg-gray-50 rounded-3xl p-6 border border-gray-100">
                <div class="flex justify-between items-end mb-2 px-1">
                    <span class="text-[10px] font-bold text-gray-500 uppercase">Havuz Verisi</span>
                    <span class="text-[11px] font-black text-blue-600" id="poolTxt">0.00 / 50.00 NI</span>
                </div>
                <div class="w-full bg-gray-200 h-2 rounded-full overflow-hidden mb-5">
                    <div id="poolBar" class="mining-bar h-full bg-blue-600 w-0 shadow-[0_0_10px_rgba(37,99,235,0.4)]"></div>
                </div>
                <button id="claimBtn" disabled onclick="claimTokens()" class="w-full py-4 rounded-2xl font-black text-[10px] bg-gray-200 text-gray-400 transition-all uppercase tracking-widest">Bakiyeye Kilitle (Min 50)</button>
            </div>
        </div>

        <button onclick="toggleMining()" id="mineBtn" class="w-full bg-gray-900 text-white py-6 rounded-[28px] font-bold text-lg shadow-2xl mb-8 active:scale-95 transition-all flex justify-center items-center gap-3">
            <span id="mineIcon">ğŸš€</span> <span id="mineText">AÄI ATEÅLE</span>
        </button>

        <div class="grid grid-cols-2 gap-4">
            <div class="apple-card p-5 text-center">
                <p class="text-[9px] text-gray-400 font-bold uppercase mb-1">Veri HÄ±zÄ±</p>
                <p class="text-xl font-black text-blue-600" id="uiMult">x1.00</p>
            </div>
            <div class="apple-card p-5 text-center">
                <p class="text-[9px] text-gray-400 font-bold uppercase mb-1">EÄŸitilen Veri</p>
                <p class="text-xl font-black text-gray-900" id="uiCor">0</p>
            </div>
        </div>
    </main>

    <main id="tab-tasks" class="tab-content pt-24 px-6 max-w-md mx-auto">
        <div id="task-intro" class="apple-card p-10 text-center">
            <div class="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6 text-3xl">ğŸ§ </div>
            <h2 class="text-3xl font-black mb-4 tracking-tighter">Vera Veri EÄŸitimi</h2>
            <p class="text-gray-500 text-sm mb-10 leading-relaxed">Nexus SÃ¼per BilgisayarÄ±'nÄ±n gÃ¶zÃ¼ ol. Resimleri analiz et, her doÄŸru veri iÃ§in +0.5 NI kazan.</p>
            <button onclick="startTraining()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg">EÄÄ°TÄ°MÄ° BAÅLAT</button>
        </div>

        <div id="task-area" class="hidden">
            <div class="apple-card p-4 relative overflow-hidden">
                <div id="task-loader" class="hidden absolute inset-0 bg-white/95 z-20 flex items-center justify-center flex-col">
                    <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-[10px] font-black tracking-widest text-gray-400">VERÄ° ANALÄ°Z EDÄ°LÄ°YOR...</p>
                </div>
                <img id="qImg" src="https://picsum.photos/400/300" class="w-full h-72 object-cover rounded-[24px] mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="checkTask(true)" class="py-5 bg-gray-50 border border-gray-100 rounded-2xl font-black text-xs hover:bg-blue-600 hover:text-white transition-all uppercase">AI ÃœRETÄ°MÄ°</button>
                    <button onclick="checkTask(false)" class="py-5 bg-gray-50 border border-gray-100 rounded-2xl font-black text-xs hover:bg-green-600 hover:text-white transition-all uppercase">GERÃ‡EK FOTO</button>
                </div>
            </div>
        </div>
    </main>

    <main id="tab-market" class="tab-content pt-24 px-6 max-w-md mx-auto">
        <div class="apple-card p-6 mb-6">
            <h3 class="text-xs font-black text-blue-600 mb-4 uppercase tracking-widest">Pilot Envanteri</h3>
            <div class="flex justify-between items-center bg-gray-50 p-5 rounded-2xl border border-gray-100">
                <span class="text-xs font-bold text-gray-500">SatÄ±n AlÄ±nan NI</span>
                <span class="text-2xl font-black text-gray-900" id="invBought">0</span>
            </div>
        </div>

        <div class="apple-card p-8 mb-6">
            <h3 class="font-black text-lg mb-2">NI Token LansmanÄ±</h3>
            <p class="text-xs text-gray-400 mb-6 italic">AÄŸdaki yerini ÅŸimdiden ayÄ±r, madencilik dÄ±ÅŸÄ±nda portfÃ¶yÃ¼nÃ¼ bÃ¼yÃ¼t.</p>
            <div class="relative mb-4">
                <input type="number" id="buyAmt" placeholder="TON MiktarÄ±" class="w-full bg-gray-50 border-gray-100 p-5 rounded-2xl outline-none font-bold text-gray-900 focus:ring-2 ring-blue-500/20">
                <span class="absolute right-5 top-5 font-black text-gray-300">TON</span>
            </div>
            <button onclick="buyToken()" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg uppercase text-xs tracking-widest">Token Rezerve Et</button>
        </div>

        <div class="apple-card p-8 bg-gray-900 text-white border-none shadow-xl mb-10">
            <h3 class="text-xl font-black mb-4 italic">The Vera Vision</h3>
            <div class="space-y-4 text-[11px] text-gray-400 leading-relaxed font-medium">
                <p><strong class="text-white">Nexus Intelligence Labs:</strong> Merkeziyetsiz bir sÃ¼per bilgisayar aÄŸÄ±dÄ±r. Apple ve Android cihazlarÄ±n boÅŸta kalan gÃ¼cÃ¼nÃ¼ AI eÄŸitimi iÃ§in birleÅŸtirir.</p>
                <p><strong class="text-white">Elite NFT:</strong> AÄŸ Ã¼zerindeki dÃ¼ÄŸÃ¼m sahipliÄŸidir. KalÄ±cÄ± Ã§arpan artÄ±ÅŸÄ± ve yÃ¶netim haklarÄ± saÄŸlar.</p>
            </div>
            <button onclick="alert('NexusIntelligenceLabs: GeleceÄŸin yapay zekasÄ±nÄ± senin cihazÄ±nla eÄŸitiyoruz. Web3 ve AI entegrasyonunun kalbi burasÄ±.')" class="w-full bg-white/10 hover:bg-white/20 text-white py-4 rounded-xl mt-6 font-bold text-[10px] uppercase tracking-widest">Tam Whitepaper'Ä± Oku</button>
        </div>
    </main>

    <div class="fixed bottom-0 w-full bg-white/80 backdrop-blur-2xl border-t border-gray-100 flex justify-around py-6 z-50">
        <button onclick="switchTab('pilot', this)" class="nav-btn flex flex-col items-center gap-1 nav-active">
            <span class="text-xl">ğŸš€</span><span class="text-[9px] font-black uppercase">Dashboard</span>
        </button>
        <button onclick="switchTab('tasks', this)" class="nav-btn flex flex-col items-center gap-1 text-gray-400">
            <span class="text-xl">ğŸ§ </span><span class="text-[9px] font-black uppercase">GÃ¶rev</span>
        </button>
        <button onclick="switchTab('market', this)" class="nav-btn flex flex-col items-center gap-1 text-gray-400">
            <span class="text-xl">ğŸ’</span><span class="text-[9px] font-black uppercase">Market</span>
        </button>
    </div>

    <script>
        // ğŸ›ï¸ SUPABASE & ADMIN CONFIG
        const SB_URL = "https://gdpiehrnpeiauhmaoumi.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdkcGllaHJucGVpYXVobWFvdW1pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMDk4MjcsImV4cCI6MjA4NjU4NTgyN30.iJHq9gnoPtBLaRuByLOV8VjesBL9qp1rQs1d4_fYJXM";
        const sb = supabase.createClient(SB_URL, SB_KEY);
        const ADMIN = "UQA6kwFHkH3c9GcYxLsrL9aw_CfyLJkmU-nAatQk-IY5bC68";

        let pilot = { w: null, main: 0, pool: 0, mult: 1.0, cor: 0, b: 0 };
        let timer = null;

        // ğŸ“± CÄ°HAZ TESPÄ°TÄ° (TAM GERÄ° GELDÄ°)
        window.onload = () => {
            const ua = navigator.userAgent;
            const device = /iPhone|iPad|iPod/.test(ua) ? "iPhone Pilot Node" : /Android/.test(ua) ? "Android Pilot Node" : "Nexus Web Console";
            document.getElementById('device-tag').innerText = device + " | Online";
        };

        // UI LOGIC
        function switchTab(t, btn) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.replace('nav-active', 'text-gray-400'));
            document.getElementById('tab-' + t).classList.add('active');
            btn.classList.replace('text-gray-400', 'nav-active');
        }

        // TON CONNECT
        const tonUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://nexusintelligencelabs.github.io/nexusintelligence.github.io/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });

        tonUI.onStatusChange(async w => {
            if (w) { pilot.w = w.account.address; loadData(); }
        });

        async function loadData() {
            const { data } = await sb.from('pilots').select('*').eq('wallet_address', pilot.w).single();
            if (data) {
                pilot.main = data.total_ni; pilot.mult = data.multiplier; pilot.cor = data.correct_images;
                updateUI();
            }
            // SipariÅŸ geÃ§miÅŸi
            const { data: ord } = await sb.from('orders').select('received_ni').eq('wallet_address', pilot.w);
            if(ord) {
                pilot.b = ord.reduce((s, i) => s + (i.received_ni || 0), 0);
                document.getElementById('invBought').innerText = pilot.b.toLocaleString();
            }
        }

        function updateUI() {
            document.getElementById('mainBal').innerText = pilot.main.toFixed(2);
            document.getElementById('poolTxt').innerText = `${pilot.pool.toFixed(2)} / 50.00 NI`;
            document.getElementById('uiMult').innerText = `x${pilot.mult.toFixed(2)}`;
            document.getElementById('uiCor').innerText = pilot.cor;
            
            let prog = (pilot.pool / 50) * 100;
            document.getElementById('poolBar').style.width = Math.min(prog, 100) + "%";
            
            if (pilot.pool >= 50) {
                const c = document.getElementById('claimBtn');
                c.disabled = false;
                c.classList.replace('bg-gray-200', 'bg-blue-600');
                c.classList.replace('text-gray-400', 'text-white');
            }
        }

        // MINING
        function toggleMining() {
            const b = document.getElementById('mineBtn');
            const t = document.getElementById('mineText');
            if (!timer) {
                t.innerText = "DURDUR"; b.classList.replace('bg-gray-900', 'bg-red-600');
                timer = setInterval(() => { pilot.pool += (0.01 * pilot.mult); updateUI(); }, 1000);
            } else {
                t.innerText = "AÄI ATEÅLE"; b.classList.replace('bg-red-600', 'bg-gray-900');
                clearInterval(timer); timer = null;
                save();
            }
        }

        async function claimTokens() {
            if (pilot.pool < 50) return;
            pilot.main += pilot.pool; pilot.pool = 0; updateUI(); save();
            alert("Hasat BaÅŸarÄ±lÄ±! 50 NI Ana Bakiyeye MÃ¼hÃ¼rlendi.");
        }

        async function save() {
            if (!pilot.w) return;
            await sb.from('pilots').upsert({ wallet_address: pilot.w, total_ni: pilot.main, correct_images: pilot.cor, multiplier: pilot.mult });
        }

        // TASKS
        let curAns = true;
        function startTraining() {
            document.getElementById('task-intro').classList.add('hidden');
            document.getElementById('task-area').classList.remove('hidden');
            nextQ();
        }
        function nextQ() {
            document.getElementById('task-loader').classList.add('hidden');
            curAns = Math.random() > 0.5;
            document.getElementById('qImg').src = `https://picsum.photos/400/300?sig=${Math.random()}`;
        }
        function checkTask(val) {
            if (val === curAns) { pilot.main += 0.5; pilot.cor++; updateUI(); save(); }
            document.getElementById('task-loader').classList.remove('hidden');
            setTimeout(nextQ, 2000);
        }

        // MARKET
        async function buyToken() {
            const a = document.getElementById('buyAmt').value;
            if(!a || a <= 0 || !pilot.w) return alert("Hata! Miktar veya cÃ¼zdan eksik.");
            try {
                await tonUI.sendTransaction({
                    validUntil: Math.floor(Date.now()/1000)+60,
                    messages: [{ address: ADMIN, amount: (a * 1000000000).toString() }]
                });
                await sb.from('orders').insert({ wallet_address: pilot.w, item_type: 'COIN', amount_ton: parseFloat(a), received_ni: a * 10000 });
                alert("Ä°ÅŸlem BaÅŸarÄ±lÄ±! NI Tokenlar Envanterine Eklendi.");
                loadData();
            } catch(e) { alert("Ä°ÅŸlem Ä°ptal Edildi."); }
        }
    </script>
</body>
</html>
